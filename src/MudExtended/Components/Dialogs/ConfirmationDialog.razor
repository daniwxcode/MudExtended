@using MudBlazor
@using MudExtended.Enums
@using MudExtended.Services.Localization

<MudDialog>
<TitleContent>
    <MudText Typo="Typo.h6">@ResolvedTitle</MudText>
</TitleContent>
<DialogContent>
        <div class="d-flex flex-column align-center pa-4">
            @if (!string.IsNullOrWhiteSpace(Icon))
            {
                <MudIcon Icon="@Icon" Color="@IconColor" Size="Size.Large" Class="mb-4" />
            }
            
            @if (MessageContent is not null)
            {
                @MessageContent
            }
            else if (!string.IsNullOrWhiteSpace(Message))
            {
                <MudText Typo="Typo.body1" Align="Align.Center">@Message</MudText>
            }
        </div>
    </DialogContent>
    <DialogActions>
        @if (ShowCancelButton)
        {
        <MudButton OnClick="Cancel" Variant="Variant.Text">@ResolvedCancelText</MudButton>
        }
        <MudButton OnClick="Confirm" 
                   Variant="Variant.Filled" 
                   Color="@ConfirmButtonColor" 
                   Disabled="@ConfirmDisabled">
            @ResolvedConfirmText
        </MudButton>
    </DialogActions>
</MudDialog>

@code {
/// <summary>
/// Instance du dialog MudBlazor.
/// </summary>
[CascadingParameter]
    private IMudDialogInstance MudDialog { get; set; } = default!;

    [Inject]
    private ILocalizationService Localization { get; set; } = default!;

    /// <summary>
    /// Dialog title.
    /// </summary>
    [Parameter]
    public string? Title { get; set; }

    /// <summary>
    /// Message text.
    /// </summary>
    [Parameter]
    public string? Message { get; set; }

    /// <summary>
    /// HTML message content.
    /// </summary>
    [Parameter]
    public RenderFragment? MessageContent { get; set; }

    /// <summary>
    /// Confirmation type.
    /// </summary>
    [Parameter]
    public ConfirmationType Type { get; set; } = ConfirmationType.Info;

    /// <summary>
    /// Confirm button text.
    /// </summary>
    [Parameter]
    public string? ConfirmText { get; set; }

    /// <summary>
    /// Cancel button text.
    /// </summary>
    [Parameter]
    public string? CancelText { get; set; }

    private string ResolvedTitle => Title ?? Localization.GetString("Dialog.Title.Confirmation");
    private string ResolvedConfirmText => ConfirmText ?? Localization.GetString("Dialog.ConfirmButton");
    private string ResolvedCancelText => CancelText ?? Localization.GetString("Dialog.CancelButton");

    /// <summary>
    /// Custom icon (auto-determined if null).
    /// </summary>
    [Parameter]
    public string? Icon { get; set; }

    /// <summary>
    /// Show the cancel button.
    /// </summary>
    [Parameter]
    public bool ShowCancelButton { get; set; } = true;

    /// <summary>
    /// Disable the confirm button.
    /// </summary>
    [Parameter]
    public bool ConfirmDisabled { get; set; }

    private Color ConfirmButtonColor => Type switch
    {
        ConfirmationType.Info => Color.Primary,
        ConfirmationType.Warning => Color.Warning,
        ConfirmationType.Danger => Color.Error,
        _ => Color.Primary
    };

    private Color IconColor => Type switch
    {
        ConfirmationType.Info => Color.Primary,
        ConfirmationType.Warning => Color.Warning,
        ConfirmationType.Danger => Color.Error,
        _ => Color.Primary
    };

    /// <inheritdoc/>
    protected override void OnParametersSet()
    {
        // Auto-determine icon if not specified
        Icon ??= Type switch
        {
            ConfirmationType.Info => Icons.Material.Filled.Info,
            ConfirmationType.Warning => Icons.Material.Filled.Warning,
            ConfirmationType.Danger => Icons.Material.Filled.Error,
            _ => Icons.Material.Filled.Help
        };
    }

    private void Confirm() => MudDialog.Close(DialogResult.Ok(true));

    private void Cancel() => MudDialog.Cancel();
}
