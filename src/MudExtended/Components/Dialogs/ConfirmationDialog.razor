@using MudBlazor
@using MudExtended.Enums

<MudDialog>
    <DialogContent>
        <div class="d-flex flex-column align-center pa-4">
            @if (!string.IsNullOrWhiteSpace(Icon))
            {
                <MudIcon Icon="@Icon" Color="@IconColor" Size="Size.Large" Class="mb-4" />
            }
            
            @if (MessageContent is not null)
            {
                @MessageContent
            }
            else if (!string.IsNullOrWhiteSpace(Message))
            {
                <MudText Typo="Typo.body1" Align="Align.Center">@Message</MudText>
            }
        </div>
    </DialogContent>
    <DialogActions>
        @if (ShowCancelButton)
        {
            <MudButton OnClick="Cancel" Variant="Variant.Text">@CancelText</MudButton>
        }
        <MudButton OnClick="Confirm" 
                   Variant="Variant.Filled" 
                   Color="@ConfirmButtonColor" 
                   Disabled="@ConfirmDisabled">
            @ConfirmText
        </MudButton>
    </DialogActions>
</MudDialog>

@code {
    /// <summary>
    /// Instance du dialog MudBlazor.
    /// </summary>
    [CascadingParameter]
    private MudDialogInstance MudDialog { get; set; } = default!;

    /// <summary>
    /// Titre du dialog.
    /// </summary>
    [Parameter]
    public string Title { get; set; } = "Confirmation";

    /// <summary>
    /// Message texte.
    /// </summary>
    [Parameter]
    public string? Message { get; set; }

    /// <summary>
    /// Contenu HTML du message.
    /// </summary>
    [Parameter]
    public RenderFragment? MessageContent { get; set; }

    /// <summary>
    /// Type de confirmation.
    /// </summary>
    [Parameter]
    public ConfirmationType Type { get; set; } = ConfirmationType.Info;

    /// <summary>
    /// Texte du bouton de confirmation.
    /// </summary>
    [Parameter]
    public string ConfirmText { get; set; } = "Confirmer";

    /// <summary>
    /// Texte du bouton d'annulation.
    /// </summary>
    [Parameter]
    public string CancelText { get; set; } = "Annuler";

    /// <summary>
    /// Ic�ne personnalis�e (auto-d�termin�e si null).
    /// </summary>
    [Parameter]
    public string? Icon { get; set; }

    /// <summary>
    /// Afficher le bouton d'annulation.
    /// </summary>
    [Parameter]
    public bool ShowCancelButton { get; set; } = true;

    /// <summary>
    /// D�sactiver le bouton de confirmation.
    /// </summary>
    [Parameter]
    public bool ConfirmDisabled { get; set; }

    private Color ConfirmButtonColor => Type switch
    {
        ConfirmationType.Info => Color.Primary,
        ConfirmationType.Warning => Color.Warning,
        ConfirmationType.Danger => Color.Error,
        _ => Color.Primary
    };

    private Color IconColor => Type switch
    {
        ConfirmationType.Info => Color.Primary,
        ConfirmationType.Warning => Color.Warning,
        ConfirmationType.Danger => Color.Error,
        _ => Color.Primary
    };

    /// <inheritdoc/>
    protected override void OnParametersSet()
    {
        // Auto-d�terminer l'ic�ne si non sp�cifi�e
        Icon ??= Type switch
        {
            ConfirmationType.Info => Icons.Material.Filled.Info,
            ConfirmationType.Warning => Icons.Material.Filled.Warning,
            ConfirmationType.Danger => Icons.Material.Filled.Error,
            _ => Icons.Material.Filled.Help
        };

        // D�finir le titre du dialog
        MudDialog.SetTitle(Title);
    }

    private void Confirm() => MudDialog.Close(DialogResult.Ok(true));

    private void Cancel() => MudDialog.Cancel();
}
