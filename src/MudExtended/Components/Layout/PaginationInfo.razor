@using MudBlazor
@using MudExtended.Models.Pagination
@using MudExtended.Services.Localization

<div class="@CombinedClass">
    <MudText Typo="Typo.body2" Color="Color.Secondary">
        @FormattedText
    </MudText>
    
    @if (ShowPageSizeSelector)
    {
        <MudSelect T="int" 
                   Value="@Pagination.PageSize" 
                   ValueChanged="OnPageSizeChanged"
                   Dense="true"
                   Margin="Margin.Dense"
                   Style="width: 80px;"
                   Class="ml-4">
            @foreach (var size in PageSizeOptions)
            {
                <MudSelectItem T="int" Value="@size">@size</MudSelectItem>
            }
        </MudSelect>
    }
</div>

@code {
[Inject]
private ILocalizationService Localization { get; set; } = default!;

/// <summary>
/// État de pagination.
/// </summary>
[Parameter, EditorRequired]
public PaginationState Pagination { get; set; } = new();

/// <summary>
/// Template d'affichage.
/// </summary>
[Parameter]
public string? Template { get; set; }

private string ResolvedTemplate => Template ?? Localization.GetString("Pagination.Template");

    /// <summary>
    /// Afficher le s�lecteur de taille de page.
    /// </summary>
    [Parameter]
    public bool ShowPageSizeSelector { get; set; }

    /// <summary>
    /// Options de taille de page.
    /// </summary>
    [Parameter]
    public int[] PageSizeOptions { get; set; } = [10, 25, 50, 100];

    /// <summary>
    /// �v�nement de changement de page.
    /// </summary>
    [Parameter]
    public EventCallback<int> OnPageChanged { get; set; }

    /// <summary>
    /// �v�nement de changement de taille.
    /// </summary>
    [Parameter]
    public EventCallback<int> OnPageSizeChanged { get; set; }

    /// <summary>
    /// Classes CSS additionnelles.
    /// </summary>
    [Parameter]
    public string? Class { get; set; }

    private string CombinedClass => string.IsNullOrWhiteSpace(Class)
        ? "mudext-pagination-info"
        : $"mudext-pagination-info {Class}";

    private string FormattedText => ResolvedTemplate
        .Replace("{from}", Pagination.DisplayFrom.ToString())
        .Replace("{to}", Pagination.DisplayTo.ToString())
        .Replace("{total}", Pagination.TotalItems.ToString())
        .Replace("{page}", Pagination.CurrentPage.ToString())
        .Replace("{pages}", Pagination.TotalPages.ToString());
}
